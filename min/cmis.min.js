/*! CmisJS - v0.2.1 - 2016-01-22
* a CMIS client library written in Javascript for node and the browser
* http://github.com/agea/CmisJS
* Copyright (c) 2016 Andrea Agili; Licensed  */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["superagent"],function(a){return b(a)}):a.cmis=b()}(this,function(){"use strict";var a={},b="undefined"!=typeof module&&module.exports,c=b&&"undefined"==typeof window;return b&&(module.exports=a),a.createSession=function(a){function b(a,b){var c=k,d=l,e=m;a.on("error",e).end(function(a,e){e.ok?c.scope?c.scope.$apply(function(){c(b?e.text:e.body)}):c(b?e.text:e.body):d.scope?d.scope.$apply(function(){d(e)}):d(e)}),this.ok=function(a){return c=a||k,this},this.$ok=function(a,b){return b.scope=a,this.ok(b)},this.notOk=function(a){return d=a||k,this},this.$notOk=function(a,b){return b.scope=a,this.notOk(b)},this.error=function(b){return e=b||k,a.on("error",e),this},this.$error=function(a,b){return b.scope=a,this.error(b)},this.getRequest=function(){return a}}var d={};d.setToken=function(a){return s.token=a,g=a,d},d.setCredentials=function(a,b){return h=a,i=b,d},d.setGlobalHandlers=function(a,b){return l=a||k,m=b||k,d},d.loadRepositories=function(){var c=new b(o(a)).ok(function(a){for(var b in a){d.defaultRepository=a[b];break}d.repositories=a,void 0!==f&&f(a)});return c.ok=function(a){return f=a,c},c},d.getObject=function(a,c,e){return e=t(e),e.cmisselector="object",e.objectId=a,("latestmajor"==c||"latest"==c)&&(e.returnVersion=c),new b(o(d.defaultRepository.rootFolderUrl).query(e))},d.getObjectByPath=function(a,c){return c=t(c),c.cmisselector="object",new b(o(d.defaultRepository.rootFolderUrl+a).query(c))},d.getObjectOfLatestVersion=function(a,c){return c=t(c),c.cmisselector="object",c.objectId=a,c.versionSeriesId=a,c.major=!!c.major,new b(o(d.defaultRepository.rootFolderUrl).query(c))},d.createFolder=function(a,c,e,f,g){var h=t({});"string"==typeof c&&(c={"cmis:name":c});var i=c||{};return i["cmis:objectTypeId"]||(i["cmis:objectTypeId"]="cmis:folder"),h.objectId=a,u(i,h),e&&v(e,h),f&&w(f,"add",h),g&&w(g,"remove",h),h.repositoryId=d.defaultRepository.repositoryId,h.cmisaction="createFolder",new b(p(d.defaultRepository.rootFolderUrl).send(h))},d.deleteObject=function(a,c,e){var e=t(e);return e.repositoryId=d.defaultRepository.repositoryId,e.cmisaction="delete",e.objectId=a,e.allVersions=!!c,new b(p(d.defaultRepository.rootFolderUrl).send(e))},d.getRepositoryInfo=function(a){return a=t(a),a.cmisselector="repositoryInfo",new b(o(d.defaultRepository.repositoryUrl).query(a))},d.getTypeChildren=function(a,c,e){return e=t(e),a&&(e.typeId=a),e.includePropertyDefinitions=c,e.cmisselector="typeChildren",new b(o(d.defaultRepository.repositoryUrl).query(e))},d.getTypeDescendants=function(a,c,e,f){return f=t(f),a&&(f.typeId=a),f.depth=c||1,f.includePropertyDefinitions=e,f.cmisselector="typeDescendants",new b(o(d.defaultRepository.repositoryUrl).query(f))},d.getTypeDefinition=function(a,c){return c=t(c),c.typeId=a,c.cmisselector="typeDefinition",new b(o(d.defaultRepository.repositoryUrl).query(c))},d.getCheckedOutDocs=function(a,c){return c=t(c),a&&(c.objectId=a),c.cmisselector="checkedOut",new b(o(d.defaultRepository.repositoryUrl).query(c))},d.createDocument=function(a,b,c,e,f,g,h,i,j){var j=t(j);"string"==typeof c&&(c={"cmis:name":c});var k=c||{};k["cmis:objectTypeId"]||(k["cmis:objectTypeId"]="cmis:document"),f&&(j.versioningState=f),j.objectId=a,u(k,j),g&&v(g,j),h&&w(h,"add",j),i&&w(i,"remove",j),j.repositoryId=d.defaultRepository.repositoryId,j.cmisaction="createDocument";var l=r(k);return q(l,j,b,e,k["cmis:name"])},d.createDocumentFromSource=function(a,b,c,e,f,g,h,i,j,k){var k=t(k);"string"==typeof e&&(e={"cmis:name":e});var l=e||{};return l["cmis:objectTypeId"]||(l["cmis:objectTypeId"]="cmis:document"),g&&(k.versioningState=g),k.objectId=a,k.sourceId=b,u(l,k),h&&v(h,k),i&&w(i,"add",k),j&&w(j,"remove",k),k.repositoryId=d.defaultRepository.repositoryId,k.cmisaction="createDocumentFromSource",q(d.defaultRepository.rootFolderUrl,k,c,f,l["cmis:name"])},d.createRelationship=function(a,c,e,f,g){return g=t(g),u(a,g),c&&v(c,g),e&&w(e,"add",g),f&&w(f,"remove",g),g.cmisaction="createRelationship",new b(p(d.defaultRepository.repositoryUrl).send(g))},d.createPolicy=function(a,c,e,f,g,h){return h=t(h),h.objectId=a,u(c,h),e&&v(e,h),f&&w(f,"add",h),g&&w(g,"remove",h),h.cmisaction="createPolicy",new b(p(d.defaultRepository.rootFolderUrl).send(h))},d.createItem=function(a,c,e,f,g,h){return h=t(h),h.objectId=a,u(c,h),e&&v(e,h),f&&w(f,"add",h),g&&w(g,"remove",h),h.cmisaction="createItem",new b(p(d.defaultRepository.rootFolderUrl).send(h))},d.bulkUpdateProperties=function(a,c,e,f,g){for(var g=t(g),h=a.length-1;h>=0;h--)g["objectId["+h+"]"]=a[h];return g.objectIds=a,u(c,g),e&&x(e,"add",g),f&&x(f,"remove",g),g.cmisaction="bulkUpdate",new b(p(d.defaultRepository.repositoryUrl).send(g))},d.query=function(a,c,e){return e=t(e),e.cmisaction="query",e.statement=a,e.searchAllVersions=!!c,new b(p(d.defaultRepository.repositoryUrl).send(e))},d.getContentChanges=function(a,c,e,f,g){return g=t(g),g.cmisselector="contentChanges",a&&(g.changeLogToken=a),g.includeProperties=!!c,g.includePolicyIds=!!e,g.includeACL=!!f,new b(o(d.defaultRepository.repositoryUrl).query(g))},d.createType=function(a,c){return c=t(c),c.cmisaction="createType",c.type=JSON.stringify(a),new b(p(d.defaultRepository.repositoryUrl).send(c))},d.updateType=function(a,c){return c=t(c),c.cmisaction="updateType",c.type=JSON.stringify(a),new b(p(d.defaultRepository.repositoryUrl).send(c))},d.deleteType=function(a,c){return c=t(c),c.cmisaction="deleteType",c.typeId=a,new b(p(d.defaultRepository.repositoryUrl).send(c))},d.getLastResult=function(a){return a=t(a),a.cmisaction="lastResult",new b(p(d.defaultRepository.repositoryUrl).send(a))},d.getChildren=function(a,c){return c=t(c),c.cmisselector="children",c.objectId=a,new b(o(d.defaultRepository.rootFolderUrl).query(c))},d.getDescendants=function(a,c,e){return e=t(e),e.cmisselector="descendants",c&&(e.depth=c),e.objectId=a,new b(o(d.defaultRepository.rootFolderUrl).query(e))},d.getFolderTree=function(a,c,e){return e=t(e),e.cmisselector="folderTree",c&&(e.depth=c),e.objectId=a,new b(o(d.defaultRepository.rootFolderUrl).query(e))},d.getFolderParent=function(a,c){return c=t(c),c.cmisselector="parent",c.objectId=a,new b(o(d.defaultRepository.rootFolderUrl).query(c))},d.getParents=function(a,c){return c=t(c),c.cmisselector="parents",c.objectId=a,new b(o(d.defaultRepository.rootFolderUrl).query(c))},d.getAllowableActions=function(a,c){return c=t(c),c.cmisselector="allowableActions",c.objectId=a,new b(o(d.defaultRepository.rootFolderUrl).query(c))},d.getProperties=function(a,c,e){return e=t(e),e.cmisselector="properties",e.objectId=a,("latestmajor"==c||"latest"==c)&&(e.returnVersion=c),new b(o(d.defaultRepository.rootFolderUrl).query(e))},d.getContentStream=function(a,c,e){return e=t(e),e.cmisselector="content",e.objectId=a,e.download=c?"attachment":"inline",new b(o(d.defaultRepository.rootFolderUrl).query(e),!0)},c&&(d.pipeContentStream=function(a,b,c){b=t(b),b.cmisselector="content",b.objectId=a,o(d.defaultRepository.rootFolderUrl).query(b).pipe(c)}),d.getContentStreamURL=function(a,b,c){c=t(c),c.cmisselector="content",c.objectId=a,c.download=b?"attachment":"inline";var e=[];for(var f in c)e.push(encodeURIComponent(f)+"="+encodeURIComponent(c[f]));var g=e.join("&");return d.defaultRepository.rootFolderUrl+"?"+g},d.getRenditions=function(a,c){return c=t(c),c.cmisselector="renditions",c.objectId=a,c.renditionFilter=c.renditionFilter||"*",new b(o(d.defaultRepository.rootFolderUrl).query(c))},d.updateProperties=function(a,c,e){var e=t(e);return u(c,e),e.cmisaction="update",new b(p(d.defaultRepository.rootFolderUrl).query({objectId:a}).send(e))},d.moveObject=function(a,c,e,f){var f=t(f);return f.objectId=a,f.cmisaction="move",f.targetFolderId=e,f.sourceFolderId=c,new b(p(d.defaultRepository.rootFolderUrl).send(f))},d.deleteTree=function(a,c,e,f,g){var g=t(g);return g.repositoryId=d.defaultRepository.repositoryId,g.cmisaction="deleteTree",g.objectId=a,g.allVersions=!!c,e&&(g.unfileObjects=e),g.continueOnFailure=!!f,new b(p(d.defaultRepository.rootFolderUrl).send(g))},d.setContentStream=function(a,b,c,e,f){var f=t(f);return f.objectId=a,f.overwriteFlag=!!c,f.cmisaction="setContent",q(d.defaultRepository.rootFolderUrl,f,b,e)},d.appendContentStream=function(a,b,c,e){var e=t(e);return e.objectId=a,e.cmisaction="appendContent",e.isLastChunk=!!c,q(d.defaultRepository.rootFolderUrl,e,b)},d.deleteContentStream=function(a,c){var c=t(c);return c.objectId=a,c.cmisaction="deleteContent",new b(p(d.defaultRepository.rootFolderUrl).send(c))},d.addObjectToFolder=function(a,c,e,f){var f=t(f);return f.cmisaction="addObjectToFolder",f.allVersions=!!e,f.folderId=c,new b(p(d.defaultRepository.rootFolderUrl).query({objectId:a}).send(f))},d.removeObjectFromFolder=function(a,c,e){var e=t(e);return e.objectId=a,e.cmisaction="removeObjectFromFolder",e.folderId=c,new b(p(d.defaultRepository.rootFolderUrl).send(e))},d.checkOut=function(a,c){var c=t(c);return c.objectId=a,c.cmisaction="checkOut",new b(p(d.defaultRepository.rootFolderUrl).send(c))},d.cancelCheckOut=function(a,c){var c=t(c);return c.objectId=a,c.cmisaction="cancelCheckOut",new b(p(d.defaultRepository.rootFolderUrl).send(c))},d.checkIn=function(a,b,c,e,f,g,h,i,j){var j=t(j);"string"==typeof c&&(c={"cmis:name":c});var k=c||{};return f&&(j.checkinComment=f),j.major=!!b,j.objectId=a,u(k,j),g&&v(g,j),h&&w(h,"add",j),i&&w(i,"remove",j),j.cmisaction="checkIn",q(d.defaultRepository.rootFolderUrl,j,e,j.mimeType||k["cmis:contentStreamMimeType"],k["cmis:name"])},d.getAllVersions=function(a,c){var c=t(c);return c.versionSeriesId=a,c.cmisselector="versions",new b(o(d.defaultRepository.rootFolderUrl).query(c))},d.getObjectRelationships=function(a,c,e,f,g){var g=t(g);return g.objectId=a,g.includeSubRelationshipTypes=!!c,g.relationshipDirection=e||"either",f&&(g.typeId=f),g.cmisselector="relationships",new b(o(d.defaultRepository.rootFolderUrl).query(g))},d.getAppliedPolicies=function(a,c){var c=t(c);return c.objectId=a,c.cmisselector="policies",new b(o(d.defaultRepository.rootFolderUrl).query(c))},d.applyPolicy=function(a,c,e){var e=t(e);return e.objectId=a,e.policyId=c,e.cmisaction="applyPolicy",new b(p(d.defaultRepository.rootFolderUrl).send(e))},d.removePolicy=function(a,c,e){var e=t(e);return e.objectId=a,e.policyId=c,e.cmisaction="removePolicy",new b(p(d.defaultRepository.rootFolderUrl).send(e))},d.applyACL=function(a,c,e,f,g){var g=t(g);return g.objectId=a,g.cmisaction="applyACL",w(c,"add",g),w(e,"remove",g),new b(p(d.defaultRepository.rootFolderUrl).send(g))},d.getACL=function(a,c,e){var e=t(e);return e.objectId=a,e.onlyBasicPermissions=!!c,e.cmisselector="acl",new b(o(d.defaultRepository.rootFolderUrl).query(e))};var e;e="undefined"!=typeof module&&module.exports?require("superagent"):window.superagent;var f,g=null,h=null,i=null,j=null;c&&process.env.http_proxy&&(j=process.env.http_proxy);var k=function(){},l=k,m=k,n=function(a,b){var c;if(j){var d=require("superagent-proxy");c=d(e(a,b),j)}else c=e(a,b);return h&&i&&c.auth(h,i),g&&c.set("Authorization","Bearer "+g),c},o=function(a){return n("GET",a)},p=function(a,b){var c=n("POST",a).type("form");return b||(c.send=c.query),c},q=function(a,d,e,f){var g=p(a,!0);if(c){var h=g.type("multipart/form-data").part();e&&(h.set("Content-Disposition",'form-data; name="content"; filename="data"'),f&&h.set("Content-Type",f),h.write(e));for(var i in d)g.part().set("Content-Disposition",'form-data; name="'+i+'"').set("Content-Type","text/plain").write(""+d[i])}else{var j=new FormData;e&&("string"==typeof e&&(e=new Blob([e])),j.append("content",e));for(var i in d)j.append(i,d[i]);g.send(j),delete g.header["Content-Type"]}return new b(g)},r=function(a){var b,c=0;for(var e in a){if("cmis:name"==e)break;c++}return b=d.defaultRepository.rootFolderUrl.indexOf("?")>-1?d.defaultRepository.rootFolderUrl+"&propertyValue["+c+"]="+encodeURIComponent(a["cmis:name"]):d.defaultRepository.rootFolderUrl+"?propertyValue["+c+"]="+encodeURIComponent(a["cmis:name"])},s={succinct:!0},t=function(a){var b={};for(var c in s)b[c]=s[c];if(void 0===a)return b;for(c in a)b[c]=a[c];return b},u=function(a,b){var c=0;for(var d in a){b["propertyId["+c+"]"]=d;var e=a[d];if(null!==e&&void 0!==e)if("[object Array]"==Object.prototype.toString.apply(e))for(var f=0;f<e.length;f++)b["propertyValue["+c+"]["+f+"]"]=e[f];else b["propertyValue["+c+"]"]=e;c++}},v=function(a,b){for(var c=0;c<a.length;c++)b["policy["+c+"]"]=a[c]},w=function(a,b,c){var d=0;for(var e in a){c[b+"ACEPrincipal["+d+"]"]=e;for(var f=a[e],g=0;g<f.length;g++)c[b+"ACEPermission["+d+"]["+g+"]"]=a[e][g];d++}},x=function(a,b,c){for(var d=0;d<a.length;d++)c[b+"SecondaryTypeId["+d+"]"]=a[d]};return d},a});